<!DOCTYPE html>
<html lang="ar" dir="rtl" id="htmlTag">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Ø§Ù„Ø¢ØºØ§ Ø¨Ø±Ùˆ - Ø§Ù„ØªÙˆØ§ÙÙ‚ Ø§Ù„Ø°ÙƒÙŠ</title>
<link href="https://fonts.googleapis.com/css2?family=Changa:wght@400;600;700&family=IBM+Plex+Sans+Arabic:wght@300;500;700&display=swap" rel="stylesheet">
<style>
  :root {
    --main-gradient: linear-gradient(135deg, #0062ff 0%, #00d2ff 100%);
    --bg-color: #f0f4f8;
    --card-bg: rgba(255, 255, 255, 0.9);
    --text-main: #1a202c;
    --accent-glow: rgba(0, 98, 255, 0.2);
    --radius: 20px;
  }

  body {
    font-family: 'IBM Plex Sans Arabic', 'Changa', sans-serif;
    background: var(--bg-color);
    background-image: 
      radial-gradient(at 0% 0%, rgba(0, 210, 255, 0.15) 0px, transparent 50%),
      radial-gradient(at 100% 100%, rgba(0, 98, 255, 0.15) 0px, transparent 50%);
    margin: 0; min-height: 100vh;
    color: var(--text-main); display: flex; flex-direction: column;
    user-select: none;
  }

  /* ÙˆØ§Ø¬Ù‡Ø© Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù„ØºØ© */
  #langOverlay {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    background: var(--main-gradient); z-index: 2000;
    display: none; flex-direction: column; justify-content: center; align-items: center; color: white;
  }
  .lang-init-btn {
    background: white; color: #0062ff; border: none;
    padding: 15px 40px; border-radius: 12px; margin: 10px;
    font-weight: 700; cursor: pointer; font-size: 1.2rem; width: 220px;
    box-shadow: 0 10px 20px rgba(0,0,0,0.1);
  }

  /* Ø²Ø± Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ø³Ø±ÙŠØ¹ Ø§Ù„Ø¹Ù„ÙˆÙŠ */
  .lang-switcher {
    position: absolute; top: 20px; right: 20px;
    background: rgba(255, 255, 255, 0.25);
    color: white; border: 1px solid rgba(255,255,255,0.4);
    padding: 6px 15px; border-radius: 10px;
    cursor: pointer; font-weight: 700; z-index: 100;
    backdrop-filter: blur(10px); transition: 0.3s;
  }
  .lang-switcher:hover { background: rgba(255, 255, 255, 0.4); }

  header {
    background: var(--main-gradient); padding: 4rem 1rem;
    text-align: center; color: white; border-radius: 0 0 50px 50px;
    box-shadow: 0 10px 30px var(--accent-glow); position: relative; overflow: hidden;
  }

  header h1 { font-size: 2.8rem; margin: 0; font-weight: 700; text-shadow: 0 4px 10px rgba(0,0,0,0.1); }
  header p { opacity: 0.9; font-size: 1.1rem; margin-top: 10px; }

  .admin-dot {
    position: absolute; top: 20px; left: 20px;
    width: 15px; height: 15px; background: rgba(255,255,255,0.3);
    border-radius: 50%; cursor: pointer; z-index: 10;
  }

  main { flex: 1; padding: 2rem 1rem; }
  .container {
    max-width: 700px; margin: -60px auto 20px;
    background: var(--card-bg); backdrop-filter: blur(10px);
    border-radius: var(--radius); padding: 2rem;
    box-shadow: 0 20px 40px rgba(0,0,0,0.05); border: 1px solid rgba(255,255,255,0.5);
  }

  label { display: block; font-weight: 600; margin-bottom: 8px; color: #4a5568; font-size: 0.95rem; }

  select, input {
    width: 100%; padding: 12px 15px; border: 2px solid #e2e8f0;
    border-radius: 12px; font-size: 1rem; margin-bottom: 20px;
    transition: all 0.3s ease; background: white; box-sizing: border-box;
  }
  select:focus, input:focus { border-color: #0062ff; box-shadow: 0 0 0 4px var(--accent-glow); outline: none; }

  .item {
    background: white; padding: 15px 20px; border-radius: 15px;
    margin-bottom: 12px; display: flex; justify-content: space-between;
    align-items: center; border: 1px solid #edf2f7; transition: transform 0.2s, box-shadow 0.2s;
  }
  .item:hover { transform: translateY(-3px); box-shadow: 0 8px 20px rgba(0,0,0,0.06); border-color: #0062ff; }
  .item .name { font-weight: 700; color: #2d3748; }
  .item .compatibility {
    background: #ebf4ff; color: #0062ff; padding: 6px 14px;
    border-radius: 10px; font-size: 0.85rem; font-weight: 600; border: 1px solid rgba(0,98,255,0.1);
  }

  .btn-primary {
    background: var(--main-gradient); color: white; border: none;
    padding: 15px; border-radius: 12px; width: 100%; font-weight: 700;
    cursor: pointer; box-shadow: 0 5px 15px var(--accent-glow); transition: 0.3s;
  }

  .admin-row {
    display: flex; justify-content: space-between; align-items: center;
    background: #fff; padding: 10px; margin-bottom: 10px;
    border-radius: 10px; font-size: 0.9rem; border: 1px solid #eee;
  }
  .admin-btns { display: flex; gap: 5px; }
  .btn-edit { background: #34d399; color: white; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer; }
  .btn-delete { background: #f87171; color: white; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer; }

  footer { text-align: center; padding: 2rem; color: #718096; font-size: 0.9rem; }
</style>
</head>
<body>

<div id="langOverlay">
  <h2 style="margin-bottom:20px;">Ø§Ø®ØªØ± Ø§Ù„Ù„ØºØ© / Select Language</h2>
  <button class="lang-init-btn" onclick="setLanguage('ar')">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</button>
  <button class="lang-init-btn" onclick="setLanguage('en')">English</button>
</div>

<button class="lang-switcher" id="langToggle" onclick="toggleLang()">EN</button>

<header>
  <div class="admin-dot" onclick="openAdmin()"></div>
  <h1 id="txt-title">Ø§Ù„Ø¢ØºØ§ Ø¨Ø±Ùˆ</h1>
  <p id="txt-subtitle">Ø¯Ù„ÙŠÙ„ Ø§Ù„Ø¢ØºØ§ Ù„Ù„ØªÙˆØ§ÙÙ‚Ø§Øª Ø§Ù„Ø°ÙƒÙŠ</p>
</header>

<main>
  <div class="container" id="customerPage">
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
      <div>
        <label id="lbl-brand">Ø§Ù„Ø´Ø±ÙƒØ©</label>
        <select id="brandSelect" onchange="onBrandOrTypeChange()">
          <option value="" disabled selected id="opt-brand-default">Ø§Ø®ØªØ±</option>
        </select>
      </div>
      <div>
        <label id="lbl-type">Ø§Ù„Ù‚Ø³Ù…</label>
        <select id="typeSelect" onchange="onBrandOrTypeChange()" disabled>
          <option value="" disabled selected id="opt-type-default">Ø§Ø®ØªØ±</option>
        </select>
      </div>
    </div>
    <input type="text" id="searchInput" placeholder="ğŸ” Ø§Ø¨Ø­Ø« Ø¹Ù† Ù…ÙˆØ¯ÙŠÙ„ Ø§Ù„Ø¬Ù‡Ø§Ø²..." oninput="renderList()" style="display:none;">
    <div id="productsList"></div>
  </div>

  <div id="adminPage" class="container" style="display:none;">
    <h3 id="txt-admin-title" style="text-align:center; color:#0062ff;">Ø¥Ø¯Ø§Ø±Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªÙˆØ§ÙÙ‚</h3>
    <label id="lbl-admin-brand">Ø§Ù„Ø´Ø±ÙƒØ©:</label>
    <select id="adminBrand"></select>
    <label id="lbl-admin-name">Ø§Ø³Ù… Ø§Ù„Ø¬Ù‡Ø§Ø²:</label>
    <input type="text" id="adminName" />
    <label id="lbl-admin-compat">Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„Ø§Øª Ø§Ù„Ù…ØªÙˆØ§ÙÙ‚Ø©:</label>
    <input type="text" id="adminPrice" />
    <label id="lbl-admin-type">Ø§Ù„Ù‚Ø³Ù…:</label>
    <select id="adminType"></select>
    <button class="btn-primary" id="btn-save" onclick="addItem()">Ø­ÙØ¸ ÙˆØªÙ†Ø²ÙŠÙ„</button>
    
    <div style="margin-top:30px; border-top:1px solid #ddd; padding-top:20px;">
        <label id="lbl-admin-list">Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©:</label>
        <input type="text" id="adminSearch" oninput="renderAdminList()">
        <div id="adminDataList"></div>
    </div>
    <button onclick="closeAdmin()" id="btn-close-admin" style="background:none; border:none; width:100%; color:#718096; margin-top:15px; cursor:pointer;">Ø¥ØºÙ„Ø§Ù‚</button>
  </div>
</main>

<footer><span id="txt-footer">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø© &copy; Ø§Ù„Ø¢ØºØ§ Ø¨Ø±Ùˆ 2026</span></footer>

<script>
  const apiUrl = "https://script.google.com/macros/s/AKfycbx2DuVr59ztRVYxQnU3OjfQTGLlmwbxnFk1lrkk8-G3vVYNqewVWXBd3oXxhEUMjyDiAg/exec";
  let allData = [];
  let currentLang = 'ar';

  const DB_BRANDS = ["Ø§ÙŠÙÙˆÙ†", "Ø³Ø§Ù…Ø³ÙˆÙ†Ø¬", "Ø´Ø§ÙˆÙ…ÙŠ", "Ù‡ÙˆØ§ÙˆÙŠ", "Ù‡ÙˆÙ†Ø±", "Ø§ÙˆØ¨Ùˆ", "ÙÙŠÙÙˆ", "Ø§Ù†ÙÙ†ÙƒØ³", "ØªÙƒÙ†Ùˆ", "Ø±ÙŠÙ„Ù…ÙŠ", "Ø¢ÙŠØªÙ„"];
  const DB_TYPES = ["Ø´Ø§Ø´Ø§Øª", "Ø¨Ø·Ø§Ø±ÙŠØ§Øª", "ÙÙ„Ø§ØªØ§Øª Ø´Ø­Ù†", "Ø§ÙŠØ³ÙŠØ§Øª", "Ù„ÙˆØ§ØµÙ‚", "Ø´Ø±Ø§Ø¦Ø·"];

  const translations = {
    ar: {
      title: "Ø§Ù„Ø¢ØºØ§ Ø¨Ø±Ùˆ", subtitle: "Ø¯Ù„ÙŠÙ„ Ø§Ù„Ø¢ØºØ§ Ù„Ù„ØªÙˆØ§ÙÙ‚Ø§Øª Ø§Ù„Ø°ÙƒÙŠ", brand: "Ø§Ù„Ø´Ø±ÙƒØ©", type: "Ø§Ù„Ù‚Ø³Ù…",
      search: "ğŸ” Ø§Ø¨Ø­Ø« Ø¹Ù† Ù…ÙˆØ¯ÙŠÙ„ Ø§Ù„Ø¬Ù‡Ø§Ø²...", select: "Ø§Ø®ØªØ±", adminTitle: "Ø¥Ø¯Ø§Ø±Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªÙˆØ§ÙÙ‚",
      adminName: "Ø§Ø³Ù… Ø§Ù„Ø¬Ù‡Ø§Ø² (Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„):", adminCompat: "Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„Ø§Øª Ø§Ù„Ù…ØªÙˆØ§ÙÙ‚Ø©:", btnSave: "Ø­ÙØ¸ ÙˆØªÙ†Ø²ÙŠÙ„",
      btnClose: "Ø¥ØºÙ„Ø§Ù‚", footer: "Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø© Â© Ø§Ù„Ø¢ØºØ§ Ø¨Ø±Ùˆ 2026", toggle: "EN",
      brands: DB_BRANDS, types: DB_TYPES
    },
    en: {
      title: "Al-Agha Pro", subtitle: "Smart Compatibility Guide", brand: "Brand", type: "Category",
      search: "ğŸ” Search device model...", select: "Select", adminTitle: "Data Management",
      adminName: "Device Model Name:", adminCompat: "Compatible Models:", btnSave: "Save & Download",
      btnClose: "Close", footer: "All Rights Reserved Â© Al-Agha Pro 2026", toggle: "AR",
      brands: ["iPhone", "Samsung", "Xiaomi", "Huawei", "Honor", "Oppo", "Vivo", "Infinix", "Techno", "Realme", "Itel"],
      types: ["Screens", "Batteries", "Charging Flex", "ICs", "Stickers", "Flex Cables"]
    }
  };

  window.onload = function() {
    const savedLang = localStorage.getItem('appLang');
    if (savedLang) { setLanguage(savedLang); } 
    else { document.getElementById('langOverlay').style.display = 'flex'; }
  };

  function setLanguage(lang) {
    currentLang = lang;
    localStorage.setItem('appLang', lang);
    document.getElementById('langOverlay').style.display = 'none';
    
    const isEn = lang === 'en';
    const t = translations[lang];
    
    document.getElementById('htmlTag').dir = isEn ? 'ltr' : 'rtl';
    document.getElementById('langToggle').innerText = t.toggle;
    document.getElementById('txt-title').innerText = t.title;
    document.getElementById('txt-subtitle').innerText = t.subtitle;
    document.getElementById('lbl-brand').innerText = t.brand;
    document.getElementById('lbl-type').innerText = t.type;
    document.getElementById('searchInput').placeholder = t.search;
    document.getElementById('opt-brand-default').innerText = t.select;
    document.getElementById('opt-type-default').innerText = t.select;
    
    document.getElementById('txt-admin-title').innerText = t.adminTitle;
    document.getElementById('lbl-admin-brand').innerText = t.brand + ":";
    document.getElementById('lbl-admin-name').innerText = t.adminName;
    document.getElementById('lbl-admin-compat').innerText = t.adminCompat;
    document.getElementById('lbl-admin-type').innerText = t.type + ":";
    document.getElementById('btn-save').innerText = t.btnSave;
    document.getElementById('btn-close-admin').innerText = t.btnClose;
    document.getElementById('txt-footer').innerText = t.footer;

    fillSelect('brandSelect', t.brands, DB_BRANDS, t.select);
    fillSelect('typeSelect', t.types, DB_TYPES, t.select);
    fillSelect('adminBrand', t.brands, DB_BRANDS);
    fillSelect('adminType', t.types, DB_TYPES);

    fetchData();
  }

  function toggleLang() { setLanguage(currentLang === 'ar' ? 'en' : 'ar'); }

  function fillSelect(id, displayList, valueList, defaultTxt) {
    const el = document.getElementById(id);
    el.innerHTML = defaultTxt ? `<option value="" disabled selected>${defaultTxt}</option>` : '';
    displayList.forEach((text, i) => {
      const opt = document.createElement('option');
      opt.value = valueList[i];
      opt.innerText = text;
      el.appendChild(opt);
    });
  }

  async function fetchData() {
    try {
      const res = await fetch(apiUrl);
      allData = await res.json();
      document.getElementById('typeSelect').disabled = false;
      renderList();
    } catch (e) { console.error("Error", e); }
  }

  function onBrandOrTypeChange() {
    if (document.getElementById('brandSelect').value && document.getElementById('typeSelect').value) {
      document.getElementById('searchInput').style.display = 'block';
      renderList();
    }
  }

  function renderList() {
    const brand = document.getElementById('brandSelect').value.toLowerCase();
    const type = document.getElementById('typeSelect').value.toLowerCase();
    const query = document.getElementById('searchInput').value.toLowerCase();
    const list = document.getElementById('productsList');
    list.innerHTML = '';

    const filtered = allData.slice(1).filter(row => {
      return row[3].toString().toLowerCase() === brand && 
             row[2].toString().toLowerCase() === type && 
             row[0].toString().toLowerCase().includes(query);
    });

    if (filtered.length === 0 && document.getElementById('typeSelect').value) {
        list.innerHTML = `<p style="text-align:center; color:#a0aec0; margin-top:20px;">${currentLang==='ar'?'Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬..':'No results found..'}</p>`;
        return;
    }

    filtered.forEach(row => {
      const div = document.createElement('div');
      div.className = 'item';
      div.innerHTML = `<span class="name">${row[0]}</span><span class="compatibility">${row[1]}</span>`;
      list.appendChild(div);
    });
  }

  // Admin functions
  function openAdmin() {
    const pass = prompt(currentLang==='ar'?'Ø±Ù…Ø² Ø§Ù„Ø¯Ø®ÙˆÙ„:':'Enter Password:');
    if (pass === '0') {
      document.getElementById('customerPage').style.display = 'none';
      document.getElementById('adminPage').style.display = 'block';
      renderAdminList();
    }
  }
  function closeAdmin() {
    document.getElementById('adminPage').style.display = 'none';
    document.getElementById('customerPage').style.display = 'block';
  }
  function renderAdminList() {
    const query = (document.getElementById('adminSearch').value || "").toLowerCase();
    const list = document.getElementById('adminDataList');
    list.innerHTML = '';
    allData.slice(1).forEach((row, index) => {
      if (row[0].toString().toLowerCase().includes(query) || row[3].toString().toLowerCase().includes(query)) {
        const div = document.createElement('div');
        div.className = 'admin-row';
        div.innerHTML = `
          <span>${row[0]} (${row[3]})</span>
          <div class="admin-btns">
            <button class="btn-edit" onclick="editItem(${index + 1})">${currentLang === 'ar' ? 'ØªØ¹Ø¯ÙŠÙ„' : 'Edit'}</button>
            <button class="btn-delete" onclick="deleteItem(${index + 1})">${currentLang === 'ar' ? 'Ø­Ø°Ù' : 'Delete'}</button>
          </div>
        `;
        list.appendChild(div);
      }
    });
  }
  async function addItem() {
    const brand = document.getElementById('adminBrand').value;
    const name = document.getElementById('adminName').value;
    const compat = document.getElementById('adminPrice').value;
    const type = document.getElementById('adminType').value;
    if (!name || !compat) { alert(currentLang==='ar'?'Ø£ÙƒÙ…Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª':'Fill all fields'); return; }
    await fetch(apiUrl, { method: 'POST', mode: 'no-cors', body: JSON.stringify({ name, compat, type, brand, action: "add" }) });
    alert(currentLang==='ar'?'ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„':'Data Sent');
    fetchData();
  }
  async function editItem(index) {
    const row = allData[index];
    const newCompat = prompt(`${currentLang==='ar'?'ØªØ¹Ø¯ÙŠÙ„':'Edit'} ${row[0]}:`, row[1]);
    if (newCompat === null) return;
    await fetch(apiUrl, { method: 'POST', mode: 'no-cors', body: JSON.stringify({ name: row[0], compat: newCompat, type: row[2], brand: row[3], action: "edit" }) });
    fetchData();
  }
  async function deleteItem(index) {
    const row = allData[index];
    if (!confirm(currentLang==='ar'?'Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ':'Are you sure?')) return;
    await fetch(apiUrl, { method: 'POST', mode: 'no-cors', body: JSON.stringify({ name: row[0], action: "delete" }) });
    fetchData();
  }
</script>
</body>
</html>